---
title: Extracting water quality data from DataRetrieval Package
author: ~
date: '2018-02-19'
slug: extracting-water-quality-data-from-dataretrieval-package
categories: []
tags: []
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/datatables-binding/datatables.js"></script>
<link href="/rmarkdown-libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="/rmarkdown-libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="/rmarkdown-libs/dt-core/js/jquery.dataTables.min.js"></script>
<link href="/rmarkdown-libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/crosstalk/js/crosstalk.min.js"></script>
<link href="/rmarkdown-libs/leaflet/leaflet.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet/leaflet.js"></script>
<link href="/rmarkdown-libs/leafletfix/leafletfix.css" rel="stylesheet" />
<link href="/rmarkdown-libs/leaflet-label/leaflet.label.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet-label/leaflet.label.js"></script>
<script src="/rmarkdown-libs/Proj4Leaflet/proj4-compressed.js"></script>
<script src="/rmarkdown-libs/Proj4Leaflet/proj4leaflet.js"></script>
<script src="/rmarkdown-libs/leaflet-binding/leaflet.js"></script>
<script src="/rmarkdown-libs/leaflet-providers/leaflet-providers.js"></script>
<script src="/rmarkdown-libs/leaflet-providers-plugin/leaflet-providers-plugin.js"></script>


<p>In this blog post, I will be showing some capabilities of <code>dataRetrieval</code> package by USGS to extract water quality data.</p>
<p>To install the <code>dataRetrieval</code> package use the following command:</p>
<pre class="r"><code>devtools::install_github(repo = &quot;USGS-R/dataRetrieval&quot;)</code></pre>
<p>The main function I will be discussing is <code>readWQPdata</code>. The users can search the data using various options as shown below:</p>
<ul>
<li>bBox = Bounding box that uses the coordinates of lower left corner and upper right corner</li>
<li>lat / long = lat / long will be specified by the user if they are interested to see if any data is available within radial distance.</li>
<li>countycode</li>
<li>startDate:</li>
<li>endDate:</li>
<li>characteristicType</li>
<li>characteristicName : CharacteristicName can be one of following</li>
</ul>
<div id="htmlwidget-1" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51"],["Conductivity","Turbidity","Alkalinity, total","Biochemical oxygen demand, standard conditions","Chloride","Chemical oxygen demand","Hardness, Ca, Mg","Inorganic nitrogen (nitrate and nitrite)","Total dissolved solids","Kjeldahl nitrogen","Phosphorus","Total suspended solids","Temperature, air","Temperature, water","pH","Dissolved oxygen (DO)","Weather condition (WMO code 4501) (choice list)","Cadmium","Cyanide","Chromium","Copper","Fecal Coliform","Iron","Manganese","Lead","Phenol","Organic Nitrogen","Aluminum","Arsenic","Mercury","Ammonia-nitrogen","Silver","Nickel","Zinc","Depth, bottom","RBP Water Odors (choice list)","RBP Water Surface Oils (choice list)","Chlorophyll a","Orthophosphate","Specific conductance","Antimony","Selenium","Thallium","Calcium","Magnesium","Escherichia coli","Dissolved oxygen saturation","Depth, data-logger (non-ported)","Light attenuation, depth at 99%","Depth, Secchi disk depth","Flow, stream stage (choice list)"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>V1<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script>
<div id="extracting-walker-county-temperature-data" class="section level1">
<h1>Extracting walker county Temperature data</h1>
<p>Let us try to see how many stations are there is walker county Alabama that has data for 2011 period.</p>
<p>To find out the countycode we can use the function:</p>
<pre class="r"><code>dataRetrieval::countyCdLookup(state = &quot;AL&quot;, county = &quot;walker&quot;)</code></pre>
<pre><code>## [1] &quot;127&quot;</code></pre>
<p>We can see that the county code of <code>Walker County</code> is <code>127</code>. Now, let us use <code>readWQPdata</code> function with countycode as follows:</p>
<pre class="r"><code>tempwalkercounty &lt;- readWQPdata(countycode=&quot;US:01:127&quot;,startDate=&quot;2011-01-01&quot;,
                                endDate = &quot;2011-12-31&quot;,
                                characteristicName=&quot;Temperature, water&quot;)</code></pre>
<div id="use-of-bounding-box-to-extract-the-data" class="section level2">
<h2>Use of bounding box to extract the data</h2>
<pre class="r"><code>temp_bbox &lt;- readWQPdata(bBox=c(-87.26, 33.59, -87.07, 33.825),
                              startDate=&quot;2011-01-01&quot;,
                              endDate = &quot;2011-12-31&quot;,
                              characteristicName=&quot;Temperature, water&quot;) 
head(temp_bbox)</code></pre>
<pre><code>## # A tibble: 6 x 65
##   OrganizationIden~ OrganizationFormal~ ActivityIdentif~ ActivityTypeCode 
##   &lt;chr&gt;             &lt;chr&gt;               &lt;chr&gt;            &lt;chr&gt;            
## 1 21AWIC            ALABAMA DEPT. OF E~ 21AWIC-184364_1~ Field Msr/Obs-Po~
## 2 21AWIC            ALABAMA DEPT. OF E~ 21AWIC-201110_1~ Field Msr/Obs-Po~
## 3 21AWIC            ALABAMA DEPT. OF E~ 21AWIC-201108_1~ Field Msr/Obs-Po~
## 4 21AWIC            ALABAMA DEPT. OF E~ 21AWIC-201108_1~ Field Msr/Obs-Po~
## 5 21AWIC            ALABAMA DEPT. OF E~ 21AWIC-201113_1~ Field Msr/Obs-Po~
## 6 21AWIC            ALABAMA DEPT. OF E~ 21AWIC-201110_1~ Field Msr/Obs-Po~
## # ... with 61 more variables: ActivityMediaName &lt;chr&gt;,
## #   ActivityMediaSubdivisionName &lt;chr&gt;, ActivityStartDate &lt;date&gt;,
## #   ActivityStartTime.Time &lt;chr&gt;, ActivityStartTime.TimeZoneCode &lt;chr&gt;,
## #   ActivityEndDate &lt;date&gt;, ActivityEndTime.Time &lt;chr&gt;,
## #   ActivityEndTime.TimeZoneCode &lt;chr&gt;,
## #   ActivityDepthHeightMeasure.MeasureValue &lt;dbl&gt;,
## #   ActivityDepthHeightMeasure.MeasureUnitCode &lt;chr&gt;,
## #   ActivityDepthAltitudeReferencePointText &lt;chr&gt;,
## #   ActivityTopDepthHeightMeasure.MeasureValue &lt;chr&gt;,
## #   ActivityTopDepthHeightMeasure.MeasureUnitCode &lt;chr&gt;,
## #   ActivityBottomDepthHeightMeasure.MeasureValue &lt;chr&gt;,
## #   ActivityBottomDepthHeightMeasure.MeasureUnitCode &lt;chr&gt;,
## #   ProjectIdentifier &lt;int&gt;, ActivityConductingOrganizationText &lt;chr&gt;,
## #   MonitoringLocationIdentifier &lt;chr&gt;, ActivityCommentText &lt;chr&gt;,
## #   SampleAquifer &lt;chr&gt;, HydrologicCondition &lt;chr&gt;, HydrologicEvent &lt;chr&gt;,
## #   SampleCollectionMethod.MethodIdentifier &lt;chr&gt;,
## #   SampleCollectionMethod.MethodIdentifierContext &lt;chr&gt;,
## #   SampleCollectionMethod.MethodName &lt;chr&gt;,
## #   SampleCollectionEquipmentName &lt;chr&gt;,
## #   ResultDetectionConditionText &lt;chr&gt;, CharacteristicName &lt;chr&gt;,
## #   ResultSampleFractionText &lt;chr&gt;, ResultMeasureValue &lt;dbl&gt;,
## #   ResultMeasure.MeasureUnitCode &lt;chr&gt;, MeasureQualifierCode &lt;chr&gt;,
## #   ResultStatusIdentifier &lt;chr&gt;, StatisticalBaseCode &lt;chr&gt;,
## #   ResultValueTypeName &lt;chr&gt;, ResultWeightBasisText &lt;chr&gt;,
## #   ResultTimeBasisText &lt;chr&gt;, ResultTemperatureBasisText &lt;chr&gt;,
## #   ResultParticleSizeBasisText &lt;chr&gt;, PrecisionValue &lt;chr&gt;,
## #   ResultCommentText &lt;chr&gt;, USGSPCode &lt;chr&gt;,
## #   ResultDepthHeightMeasure.MeasureValue &lt;chr&gt;,
## #   ResultDepthHeightMeasure.MeasureUnitCode &lt;chr&gt;,
## #   ResultDepthAltitudeReferencePointText &lt;chr&gt;,
## #   SubjectTaxonomicName &lt;chr&gt;, SampleTissueAnatomyName &lt;chr&gt;,
## #   ResultAnalyticalMethod.MethodIdentifier &lt;chr&gt;,
## #   ResultAnalyticalMethod.MethodIdentifierContext &lt;chr&gt;,
## #   ResultAnalyticalMethod.MethodName &lt;chr&gt;, MethodDescriptionText &lt;chr&gt;,
## #   LaboratoryName &lt;chr&gt;, AnalysisStartDate &lt;date&gt;,
## #   ResultLaboratoryCommentText &lt;chr&gt;,
## #   DetectionQuantitationLimitTypeName &lt;chr&gt;,
## #   DetectionQuantitationLimitMeasure.MeasureValue &lt;dbl&gt;,
## #   DetectionQuantitationLimitMeasure.MeasureUnitCode &lt;chr&gt;,
## #   PreparationStartDate &lt;date&gt;, ProviderName &lt;chr&gt;,
## #   ActivityStartDateTime &lt;dttm&gt;, ActivityEndDateTime &lt;dttm&gt;</code></pre>
</div>
<div id="extracting-the-site-information-from-temp_bbox" class="section level2">
<h2>Extracting the site information from <code>temp_bbox</code></h2>
<pre class="r"><code>siteInfo &lt;- attr(temp_bbox, &quot;siteInfo&quot;)
head(as.tibble(siteInfo))</code></pre>
<pre><code>## # A tibble: 5 x 42
##   station_nm agency_cd site_no     dec_lat_va dec_lon_va hucCd   
##   &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;   
## 1 CLCJ-1     21AWIC    21AWIC-2228       33.6      -87.1 03160111
## 2 CLCJ-3     21AWIC    21AWIC-7015       33.6      -87.1 03160111
## 3 CLCJ-4     21AWIC    21AWIC-7016       33.6      -87.1 03160111
## 4 CHMJ-47    21AWIC    21AWIC-7033       33.6      -87.1 03160111
## 5 WIMJ-1     21AWIC    21AWIC-7034       33.6      -87.1 03160111
## # ... with 36 more variables: OrganizationIdentifier &lt;chr&gt;,
## #   OrganizationFormalName &lt;chr&gt;, MonitoringLocationIdentifier &lt;chr&gt;,
## #   MonitoringLocationName &lt;chr&gt;, MonitoringLocationTypeName &lt;chr&gt;,
## #   MonitoringLocationDescriptionText &lt;chr&gt;, HUCEightDigitCode &lt;chr&gt;,
## #   DrainageAreaMeasure.MeasureValue &lt;chr&gt;,
## #   DrainageAreaMeasure.MeasureUnitCode &lt;chr&gt;,
## #   ContributingDrainageAreaMeasure.MeasureValue &lt;chr&gt;,
## #   ContributingDrainageAreaMeasure.MeasureUnitCode &lt;chr&gt;,
## #   LatitudeMeasure &lt;dbl&gt;, LongitudeMeasure &lt;dbl&gt;,
## #   SourceMapScaleNumeric &lt;int&gt;,
## #   HorizontalAccuracyMeasure.MeasureValue &lt;chr&gt;,
## #   HorizontalAccuracyMeasure.MeasureUnitCode &lt;chr&gt;,
## #   HorizontalCollectionMethodName &lt;chr&gt;,
## #   HorizontalCoordinateReferenceSystemDatumName &lt;chr&gt;,
## #   VerticalMeasure.MeasureValue &lt;chr&gt;,
## #   VerticalMeasure.MeasureUnitCode &lt;chr&gt;,
## #   VerticalAccuracyMeasure.MeasureValue &lt;chr&gt;,
## #   VerticalAccuracyMeasure.MeasureUnitCode &lt;chr&gt;,
## #   VerticalCollectionMethodName &lt;chr&gt;,
## #   VerticalCoordinateReferenceSystemDatumName &lt;chr&gt;, CountryCode &lt;chr&gt;,
## #   StateCode &lt;chr&gt;, CountyCode &lt;chr&gt;, AquiferName &lt;chr&gt;,
## #   FormationTypeText &lt;chr&gt;, AquiferTypeName &lt;chr&gt;,
## #   ConstructionDateText &lt;chr&gt;, WellDepthMeasure.MeasureValue &lt;dbl&gt;,
## #   WellDepthMeasure.MeasureUnitCode &lt;chr&gt;,
## #   WellHoleDepthMeasure.MeasureValue &lt;dbl&gt;,
## #   WellHoleDepthMeasure.MeasureUnitCode &lt;chr&gt;, ProviderName &lt;chr&gt;</code></pre>
</div>
<div id="plot-stations-using-leaflet-library." class="section level2">
<h2>Plot stations using <code>leaflet</code> library.</h2>
<pre class="r"><code>library(leaflet)
leaflet(siteInfo) %&gt;% 
  addProviderTiles(providers$OpenStreetMap) %&gt;% 
  addCircleMarkers(~dec_lon_va, ~dec_lat_va, color = &quot;red&quot;, popup = ~station_nm)</code></pre>
<div id="htmlwidget-2" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["OpenStreetMap",null,null,{"errorTileUrl":"","noWrap":false,"zIndex":null,"unloadInvisibleTiles":null,"updateWhenIdle":null,"detectRetina":false,"reuseTiles":false}]},{"method":"addCircleMarkers","args":[[33.612475,33.607237,33.600105,33.609161,33.601111],[-87.13851,-87.135261,-87.138493,-87.135563,-87.139167],10,null,null,{"lineCap":null,"lineJoin":null,"clickable":true,"pointerEvents":null,"className":"","stroke":true,"color":"red","weight":5,"opacity":0.5,"fill":true,"fillColor":"red","fillOpacity":0.2,"dashArray":null},null,null,["CLCJ-1","CLCJ-3","CLCJ-4","CHMJ-47","WIMJ-1"],null,null,null,null]}],"limits":{"lat":[33.600105,33.612475],"lng":[-87.139167,-87.135261]}},"evals":[],"jsHooks":[]}</script>
<p>I have just scratched the surface here and would like to encourage you guys to visit the full tutorial at <code>https://owi.usgs.gov/R/dataRetrieval.html#1</code>.</p>
</div>
</div>
