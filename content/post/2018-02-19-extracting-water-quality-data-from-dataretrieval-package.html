---
title: Extracting water quality data from DataRetrieval Package
author: ~
date: '2018-02-19'
slug: extracting-water-quality-data-from-dataretrieval-package
categories: []
tags: []
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/leaflet/leaflet.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet/leaflet.js"></script>
<link href="/rmarkdown-libs/leafletfix/leafletfix.css" rel="stylesheet" />
<link href="/rmarkdown-libs/leaflet-label/leaflet.label.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet-label/leaflet.label.js"></script>
<script src="/rmarkdown-libs/Proj4Leaflet/proj4-compressed.js"></script>
<script src="/rmarkdown-libs/Proj4Leaflet/proj4leaflet.js"></script>
<script src="/rmarkdown-libs/leaflet-binding/leaflet.js"></script>
<script src="/rmarkdown-libs/leaflet-providers/leaflet-providers.js"></script>
<script src="/rmarkdown-libs/leaflet-providers-plugin/leaflet-providers-plugin.js"></script>


<p>In this blog post, I will be showing some capabilities of <code>dataRetrieval</code> package by USGS to extract water quality data.</p>
<p>To install the <code>dataRetrieval</code> package use the following command:</p>
<pre class="r"><code>devtools::install_github(repo = &quot;USGS-R/dataRetrieval&quot;)</code></pre>
<p>The main function I will be discussing is <code>readWQPdata</code>. The users can search the data using various options as shown below:</p>
<ul>
<li>bBox = Bounding box that uses the coordinates of lower left corner and upper right corner</li>
<li>lat / long = lat / long will be specified by the user if they are interested to see if any data is available within radial distance.</li>
<li>countycode</li>
<li>startDate:</li>
<li>endDate:</li>
<li>characteristicType</li>
<li>characteristicName : CharacteristicName can be one of following</li>
</ul>
<pre class="r"><code>read.table(file = &quot;../../data/0219_waterquality/characteristic_name.txt&quot;,sep = &quot;\n&quot;, header = F ) %&gt;%
  knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">V1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Conductivity</td>
</tr>
<tr class="even">
<td align="left">Turbidity</td>
</tr>
<tr class="odd">
<td align="left">Alkalinity, total</td>
</tr>
<tr class="even">
<td align="left">Biochemical oxygen demand, standard conditions</td>
</tr>
<tr class="odd">
<td align="left">Chloride</td>
</tr>
<tr class="even">
<td align="left">Chemical oxygen demand</td>
</tr>
<tr class="odd">
<td align="left">Hardness, Ca, Mg</td>
</tr>
<tr class="even">
<td align="left">Inorganic nitrogen (nitrate and nitrite)</td>
</tr>
<tr class="odd">
<td align="left">Total dissolved solids</td>
</tr>
<tr class="even">
<td align="left">Kjeldahl nitrogen</td>
</tr>
<tr class="odd">
<td align="left">Phosphorus</td>
</tr>
<tr class="even">
<td align="left">Total suspended solids</td>
</tr>
<tr class="odd">
<td align="left">Temperature, air</td>
</tr>
<tr class="even">
<td align="left">Temperature, water</td>
</tr>
<tr class="odd">
<td align="left">pH</td>
</tr>
<tr class="even">
<td align="left">Dissolved oxygen (DO)</td>
</tr>
<tr class="odd">
<td align="left">Weather condition (WMO code 4501) (choice list)</td>
</tr>
<tr class="even">
<td align="left">Cadmium</td>
</tr>
<tr class="odd">
<td align="left">Cyanide</td>
</tr>
<tr class="even">
<td align="left">Chromium</td>
</tr>
<tr class="odd">
<td align="left">Copper</td>
</tr>
<tr class="even">
<td align="left">Fecal Coliform</td>
</tr>
<tr class="odd">
<td align="left">Iron</td>
</tr>
<tr class="even">
<td align="left">Manganese</td>
</tr>
<tr class="odd">
<td align="left">Lead</td>
</tr>
<tr class="even">
<td align="left">Phenol</td>
</tr>
<tr class="odd">
<td align="left">Organic Nitrogen</td>
</tr>
<tr class="even">
<td align="left">Aluminum</td>
</tr>
<tr class="odd">
<td align="left">Arsenic</td>
</tr>
<tr class="even">
<td align="left">Mercury</td>
</tr>
<tr class="odd">
<td align="left">Ammonia-nitrogen</td>
</tr>
<tr class="even">
<td align="left">Silver</td>
</tr>
<tr class="odd">
<td align="left">Nickel</td>
</tr>
<tr class="even">
<td align="left">Zinc</td>
</tr>
<tr class="odd">
<td align="left">Depth, bottom</td>
</tr>
<tr class="even">
<td align="left">RBP Water Odors (choice list)</td>
</tr>
<tr class="odd">
<td align="left">RBP Water Surface Oils (choice list)</td>
</tr>
<tr class="even">
<td align="left">Chlorophyll a</td>
</tr>
<tr class="odd">
<td align="left">Orthophosphate</td>
</tr>
<tr class="even">
<td align="left">Specific conductance</td>
</tr>
<tr class="odd">
<td align="left">Antimony</td>
</tr>
<tr class="even">
<td align="left">Selenium</td>
</tr>
<tr class="odd">
<td align="left">Thallium</td>
</tr>
<tr class="even">
<td align="left">Calcium</td>
</tr>
<tr class="odd">
<td align="left">Magnesium</td>
</tr>
<tr class="even">
<td align="left">Escherichia coli</td>
</tr>
<tr class="odd">
<td align="left">Dissolved oxygen saturation</td>
</tr>
<tr class="even">
<td align="left">Depth, data-logger (non-ported)</td>
</tr>
<tr class="odd">
<td align="left">Light attenuation, depth at 99%</td>
</tr>
<tr class="even">
<td align="left">Depth, Secchi disk depth</td>
</tr>
<tr class="odd">
<td align="left">Flow, stream stage (choice list)</td>
</tr>
</tbody>
</table>
<div id="extracting-walker-county-temperature-data" class="section level1">
<h1>Extracting walker county Temperature data</h1>
<p>Let us try to see how many stations are there is walker county Alabama that has data for 2011 period.</p>
<p>To find out the countycode we can use the function:</p>
<pre class="r"><code>dataRetrieval::countyCdLookup(state = &quot;AL&quot;, county = &quot;walker&quot;)</code></pre>
<pre><code>## [1] &quot;127&quot;</code></pre>
<p>We can see that the county code of <code>Walker County</code> is <code>127</code>. Now, let us use <code>readWQPdata</code> function with countycode as follows:</p>
<pre class="r"><code>tempwalkercounty &lt;- readWQPdata(countycode=&quot;US:01:127&quot;,startDate=&quot;2011-01-01&quot;,
                                endDate = &quot;2011-12-31&quot;,
                                characteristicName=&quot;Temperature, water&quot;)</code></pre>
<div id="use-of-bounding-box-to-extract-the-data" class="section level2">
<h2>Use of bounding box to extract the data</h2>
<pre class="r"><code>temp_bbox &lt;- readWQPdata(bBox=c(-87.26, 33.59, -87.07, 33.825),
                              startDate=&quot;2011-01-01&quot;,
                              endDate = &quot;2011-12-31&quot;,
                              characteristicName=&quot;Temperature, water&quot;) 
head(temp_bbox)</code></pre>
<pre><code>## # A tibble: 6 x 65
##   OrganizationIden~ OrganizationFormal~ ActivityIdentif~ ActivityTypeCode 
##   &lt;chr&gt;             &lt;chr&gt;               &lt;chr&gt;            &lt;chr&gt;            
## 1 21AWIC            ALABAMA DEPT. OF E~ 21AWIC-154896_8~ Field Msr/Obs-Po~
## 2 21AWIC            ALABAMA DEPT. OF E~ 21AWIC-154889_8~ Field Msr/Obs-Po~
## 3 21AWIC            ALABAMA DEPT. OF E~ 21AWIC-154889_8~ Field Msr/Obs-Po~
## 4 21AWIC            ALABAMA DEPT. OF E~ 21AWIC-155417_9~ Field Msr/Obs-Po~
## 5 21AWIC            ALABAMA DEPT. OF E~ 21AWIC-154896_8~ Field Msr/Obs-Po~
## 6 21AWIC            ALABAMA DEPT. OF E~ 21AWIC-154911_8~ Field Msr/Obs-Po~
## # ... with 61 more variables: ActivityMediaName &lt;chr&gt;,
## #   ActivityMediaSubdivisionName &lt;chr&gt;, ActivityStartDate &lt;date&gt;,
## #   ActivityStartTime.Time &lt;chr&gt;, ActivityStartTime.TimeZoneCode &lt;chr&gt;,
## #   ActivityEndDate &lt;date&gt;, ActivityEndTime.Time &lt;chr&gt;,
## #   ActivityEndTime.TimeZoneCode &lt;chr&gt;,
## #   ActivityDepthHeightMeasure.MeasureValue &lt;dbl&gt;,
## #   ActivityDepthHeightMeasure.MeasureUnitCode &lt;chr&gt;,
## #   ActivityDepthAltitudeReferencePointText &lt;chr&gt;,
## #   ActivityTopDepthHeightMeasure.MeasureValue &lt;chr&gt;,
## #   ActivityTopDepthHeightMeasure.MeasureUnitCode &lt;chr&gt;,
## #   ActivityBottomDepthHeightMeasure.MeasureValue &lt;chr&gt;,
## #   ActivityBottomDepthHeightMeasure.MeasureUnitCode &lt;chr&gt;,
## #   ProjectIdentifier &lt;int&gt;, ActivityConductingOrganizationText &lt;chr&gt;,
## #   MonitoringLocationIdentifier &lt;chr&gt;, ActivityCommentText &lt;chr&gt;,
## #   SampleAquifer &lt;chr&gt;, HydrologicCondition &lt;chr&gt;, HydrologicEvent &lt;chr&gt;,
## #   SampleCollectionMethod.MethodIdentifier &lt;chr&gt;,
## #   SampleCollectionMethod.MethodIdentifierContext &lt;chr&gt;,
## #   SampleCollectionMethod.MethodName &lt;chr&gt;,
## #   SampleCollectionEquipmentName &lt;chr&gt;,
## #   ResultDetectionConditionText &lt;chr&gt;, CharacteristicName &lt;chr&gt;,
## #   ResultSampleFractionText &lt;chr&gt;, ResultMeasureValue &lt;dbl&gt;,
## #   ResultMeasure.MeasureUnitCode &lt;chr&gt;, MeasureQualifierCode &lt;chr&gt;,
## #   ResultStatusIdentifier &lt;chr&gt;, StatisticalBaseCode &lt;chr&gt;,
## #   ResultValueTypeName &lt;chr&gt;, ResultWeightBasisText &lt;chr&gt;,
## #   ResultTimeBasisText &lt;chr&gt;, ResultTemperatureBasisText &lt;chr&gt;,
## #   ResultParticleSizeBasisText &lt;chr&gt;, PrecisionValue &lt;chr&gt;,
## #   ResultCommentText &lt;chr&gt;, USGSPCode &lt;chr&gt;,
## #   ResultDepthHeightMeasure.MeasureValue &lt;chr&gt;,
## #   ResultDepthHeightMeasure.MeasureUnitCode &lt;chr&gt;,
## #   ResultDepthAltitudeReferencePointText &lt;chr&gt;,
## #   SubjectTaxonomicName &lt;chr&gt;, SampleTissueAnatomyName &lt;chr&gt;,
## #   ResultAnalyticalMethod.MethodIdentifier &lt;chr&gt;,
## #   ResultAnalyticalMethod.MethodIdentifierContext &lt;chr&gt;,
## #   ResultAnalyticalMethod.MethodName &lt;chr&gt;, MethodDescriptionText &lt;chr&gt;,
## #   LaboratoryName &lt;chr&gt;, AnalysisStartDate &lt;date&gt;,
## #   ResultLaboratoryCommentText &lt;chr&gt;,
## #   DetectionQuantitationLimitTypeName &lt;chr&gt;,
## #   DetectionQuantitationLimitMeasure.MeasureValue &lt;dbl&gt;,
## #   DetectionQuantitationLimitMeasure.MeasureUnitCode &lt;chr&gt;,
## #   PreparationStartDate &lt;date&gt;, ProviderName &lt;chr&gt;,
## #   ActivityStartDateTime &lt;dttm&gt;, ActivityEndDateTime &lt;dttm&gt;</code></pre>
</div>
<div id="extracting-the-site-information-from-temp_bbox" class="section level2">
<h2>Extracting the site information from <code>temp_bbox</code></h2>
<pre class="r"><code>siteInfo &lt;- attr(temp_bbox, &quot;siteInfo&quot;)
head(as.tibble(siteInfo))</code></pre>
<pre><code>## # A tibble: 5 x 42
##   station_nm agency_cd site_no     dec_lat_va dec_lon_va hucCd   
##   &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;   
## 1 CLCJ-1     21AWIC    21AWIC-2228       33.6      -87.1 03160111
## 2 CLCJ-3     21AWIC    21AWIC-7015       33.6      -87.1 03160111
## 3 CLCJ-4     21AWIC    21AWIC-7016       33.6      -87.1 03160111
## 4 CHMJ-47    21AWIC    21AWIC-7033       33.6      -87.1 03160111
## 5 WIMJ-1     21AWIC    21AWIC-7034       33.6      -87.1 03160111
## # ... with 36 more variables: OrganizationIdentifier &lt;chr&gt;,
## #   OrganizationFormalName &lt;chr&gt;, MonitoringLocationIdentifier &lt;chr&gt;,
## #   MonitoringLocationName &lt;chr&gt;, MonitoringLocationTypeName &lt;chr&gt;,
## #   MonitoringLocationDescriptionText &lt;chr&gt;, HUCEightDigitCode &lt;chr&gt;,
## #   DrainageAreaMeasure.MeasureValue &lt;chr&gt;,
## #   DrainageAreaMeasure.MeasureUnitCode &lt;chr&gt;,
## #   ContributingDrainageAreaMeasure.MeasureValue &lt;chr&gt;,
## #   ContributingDrainageAreaMeasure.MeasureUnitCode &lt;chr&gt;,
## #   LatitudeMeasure &lt;dbl&gt;, LongitudeMeasure &lt;dbl&gt;,
## #   SourceMapScaleNumeric &lt;int&gt;,
## #   HorizontalAccuracyMeasure.MeasureValue &lt;chr&gt;,
## #   HorizontalAccuracyMeasure.MeasureUnitCode &lt;chr&gt;,
## #   HorizontalCollectionMethodName &lt;chr&gt;,
## #   HorizontalCoordinateReferenceSystemDatumName &lt;chr&gt;,
## #   VerticalMeasure.MeasureValue &lt;chr&gt;,
## #   VerticalMeasure.MeasureUnitCode &lt;chr&gt;,
## #   VerticalAccuracyMeasure.MeasureValue &lt;chr&gt;,
## #   VerticalAccuracyMeasure.MeasureUnitCode &lt;chr&gt;,
## #   VerticalCollectionMethodName &lt;chr&gt;,
## #   VerticalCoordinateReferenceSystemDatumName &lt;chr&gt;, CountryCode &lt;chr&gt;,
## #   StateCode &lt;chr&gt;, CountyCode &lt;chr&gt;, AquiferName &lt;chr&gt;,
## #   FormationTypeText &lt;chr&gt;, AquiferTypeName &lt;chr&gt;,
## #   ConstructionDateText &lt;chr&gt;, WellDepthMeasure.MeasureValue &lt;dbl&gt;,
## #   WellDepthMeasure.MeasureUnitCode &lt;chr&gt;,
## #   WellHoleDepthMeasure.MeasureValue &lt;dbl&gt;,
## #   WellHoleDepthMeasure.MeasureUnitCode &lt;chr&gt;, ProviderName &lt;chr&gt;</code></pre>
</div>
<div id="plot-stations-using-leaflet-library." class="section level2">
<h2>Plot stations using <code>leaflet</code> library.</h2>
<pre class="r"><code>library(leaflet)
m &lt;- leaflet(siteInfo) %&gt;% 
  addProviderTiles(providers$OpenStreetMap) %&gt;% 
  addCircleMarkers(~dec_lon_va, ~dec_lat_va, color = &quot;red&quot;, popup = ~station_nm)
m </code></pre>
<div id="htmlwidget-1" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["OpenStreetMap",null,null,{"errorTileUrl":"","noWrap":false,"zIndex":null,"unloadInvisibleTiles":null,"updateWhenIdle":null,"detectRetina":false,"reuseTiles":false}]},{"method":"addCircleMarkers","args":[[33.612475,33.607237,33.600105,33.609161,33.601111],[-87.13851,-87.135261,-87.138493,-87.135563,-87.139167],10,null,null,{"lineCap":null,"lineJoin":null,"clickable":true,"pointerEvents":null,"className":"","stroke":true,"color":"red","weight":5,"opacity":0.5,"fill":true,"fillColor":"red","fillOpacity":0.2,"dashArray":null},null,null,["CLCJ-1","CLCJ-3","CLCJ-4","CHMJ-47","WIMJ-1"],null,null,null,null]}],"limits":{"lat":[33.600105,33.612475],"lng":[-87.139167,-87.135261]}},"evals":[],"jsHooks":[]}</script>
<p>I have just scratched the surface here and would like to encourage you guys to visit the full tutorial at <code>https://owi.usgs.gov/R/dataRetrieval.html#1</code>.</p>
</div>
</div>
