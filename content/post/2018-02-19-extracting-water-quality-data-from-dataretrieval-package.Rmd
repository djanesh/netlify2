---
title: Extracting water quality data from DataRetrieval Package
author: ~
date: '2018-02-19'
slug: extracting-water-quality-data-from-dataretrieval-package
categories: []
tags: []
---

In this blog post, I will be showing some capabilities of `dataRetrieval` package
by USGS to extract water quality data. 

To install the `dataRetrieval` package use the following command:

```{r, eval=FALSE}
devtools::install_github(repo = "USGS-R/dataRetrieval")
```

The main function I will be discussing is `readWQPdata`. The users can search the data 
using various options as shown below:

* bBox = Bounding box that uses the coordinates of lower left corner and upper right corner
* lat / long = lat / long will be specified by the user if they are interested to 
see if any data is available within radial distance. 
* countycode 
* startDate: 
* endDate: 
* characteristicType
* characteristicName : CharacteristicName can be one of following

```{r, echo=FALSE, warning=FALSE}
library(dplyr)
library(dataRetrieval)
library(dplyr)
library(leaflet)
read.table(text = "Conductivity
Turbidity
Alkalinity, total
Biochemical oxygen demand, standard conditions
Chloride
Chemical oxygen demand
Hardness, Ca, Mg
Inorganic nitrogen (nitrate and nitrite)
Total dissolved solids
Kjeldahl nitrogen
Phosphorus
Total suspended solids
Temperature, air
Temperature, water
pH
Dissolved oxygen (DO)
Weather condition (WMO code 4501) (choice list)
Cadmium
Cyanide
Chromium
Copper
Fecal Coliform
Iron
Manganese
Lead
Phenol
Organic Nitrogen
Aluminum
Arsenic
Mercury
Ammonia-nitrogen
Silver
Nickel
Zinc
Depth, bottom
RBP Water Odors (choice list)
RBP Water Surface Oils (choice list)
Chlorophyll a
Orthophosphate
Specific conductance
Antimony
Selenium
Thallium
Calcium
Magnesium
Escherichia coli
Dissolved oxygen saturation
Depth, data-logger (non-ported)
Light attenuation, depth at 99%
Depth, Secchi disk depth
Flow, stream stage (choice list)", sep = "\n", header = F) %>% 
  #knitr::kable(col.names = "Characteristic Name")
  DT::datatable()
```


# Extracting walker county Temperature data

Let us try to see how many stations are there is walker county Alabama that has data for 2011 period. 

To find out the countycode we can use the function: 
```{r}
dataRetrieval::countyCdLookup(state = "AL", county = "walker")
```
We can see that the county code of `Walker County` is `127`. Now, let us use `readWQPdata` function with countycode as follows:

```{r}

tempwalkercounty <- readWQPdata(countycode="US:01:127",startDate="2011-01-01",
                                endDate = "2011-12-31",
                                characteristicName="Temperature, water")

```


## Use of bounding box to extract the data 

```{r}
temp_bbox <- readWQPdata(bBox=c(-87.26, 33.59, -87.07, 33.825),
                              startDate="2011-01-01",
                              endDate = "2011-12-31",
                              characteristicName="Temperature, water") 
head(temp_bbox)
```

## Extracting the site information from `temp_bbox`

```{r}
siteInfo <- attr(temp_bbox, "siteInfo")
siteInfo
```

## Plot stations using `leaflet` library.
```{r}
leaflet(siteInfo) %>% 
  addProviderTiles("CartoDB.Positron") %>% 
  addCircleMarkers(~dec_lon_va, ~dec_lat_va, color = "red", popup = ~station_nm)
```

I have just scratched the surface here and would like to encourage you guys to 
visit the full tutorial at `https://owi.usgs.gov/R/dataRetrieval.html#1`.