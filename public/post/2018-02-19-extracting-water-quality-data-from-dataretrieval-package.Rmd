---
title: Extracting water quality data from DataRetrieval R Package
author: ~
date: '2018-02-19'
slug: extracting-water-quality-data-from-dataretrieval-package
categories: []
tags: []
---

In this blog post, I will be showing some capabilities of `dataRetrieval` package
by USGS to extract water quality data.  

To install the `dataRetrieval` package use the following command:

```{r, eval=FALSE}
devtools::install_github(repo = "USGS-R/dataRetrieval")
```

The main function I will be discussing is `readWQPdata`. The users can search the data 
using various options as shown below:

* bBox = Bounding box that uses the coordinates of lower left corner and upper right corner
* lat / long = lat / long will be specified by the user if they are interested to 
see if any data is available within radial distance. 
* countycode 
* startDate: 
* endDate: 
* characteristicType
* characteristicName : CharacteristicName can be one of following

```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(dplyr)
library(dataRetrieval)
library(dplyr)
library(leaflet)
library(DT)
library(tibble)
library(DT)
```

```{r, echo = TRUE, warning=FALSE}
read.table(file = "../../data/0219_waterquality/characteristic_name.txt",sep = "\n", header = F ) %>%
  knitr::kable()
```


# Extracting walker county Temperature data

Let us try to see how many stations are there is walker county Alabama that has data for 2011 period. 

To find out the countycode we can use the function: 
```{r}
dataRetrieval::countyCdLookup(state = "AL", county = "walker")
```
We can see that the county code of `Walker County` is `127`. Now, let us use `readWQPdata` function with countycode as follows:

```{r}

tempwalkercounty <- readWQPdata(countycode="US:01:127",startDate="2011-01-01",
                                endDate = "2011-12-31",
                                characteristicName="Temperature, water")

```


## Use of bounding box to extract the data 

```{r}
temp_bbox <- readWQPdata(bBox=c(-87.26, 33.59, -87.07, 33.825),
                              startDate="2011-01-01",
                              endDate = "2011-12-31",
                              characteristicName="Temperature, water") 
head(temp_bbox)
```

## Extracting the site information from `temp_bbox`

```{r}
siteInfo <- attr(temp_bbox, "siteInfo")
head(as.tibble(siteInfo))
```

## Plot stations using `leaflet` library.
```{r}
library(leaflet)
m <- leaflet(siteInfo) %>% 
  addProviderTiles(providers$OpenStreetMap) %>% 
  addCircleMarkers(~dec_lon_va, ~dec_lat_va, color = "red", popup = ~station_nm)
m 
```

I have just scratched the surface here and would like to encourage you guys to 
visit the full tutorial at `https://owi.usgs.gov/R/dataRetrieval.html#1`.